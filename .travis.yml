sudo: false
language: rust
addons:
  apt:
    packages:
    - libcurl4-openssl-dev
    - libelf-dev
    - libdw-dev
    - binutils-dev
rust:
- nightly
- beta
- stable
before_script:
- |
  pip install 'travis-cargo<0.2' --user &&
  export PATH=$HOME/.local/bin:$PATH
script:
- |
  travis-cargo build --release &&
  travis-cargo test --release
after_success: |
  [ $TRAVIS_RUST_VERSION = stable ] &&
  [ $TRAVIS_BRANCH = master ] &&
  [ $TRAVIS_PULL_REQUEST = false ] &&
  cargo doc --no-deps &&
  echo "<meta http-equiv=refresh content=0;url=`echo $TRAVIS_REPO_SLUG | cut -d '/' -f 2`/index.html>" > target/doc/index.html &&
  git clone https://github.com/davisp/ghp-import &&
  ./ghp-import/ghp_import.py -n -m "Documentation for $TRAVIS_REPO_SLUG" target/doc &&
  git push -fq https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git gh-pages
env:
  global:
    - TRAVIS_CARGO_NIGHTLY_FEATURE=""
    - secure: HoxWoR9UD62b+tGvYOZpgPCRlg4L303qcjssg8MNa2dJeip1Eehv/bWeOnxNgHmO2wjEg8DKEJbtWTXbJ0wFxT1PTUgoJVSo3raNN0vZjnwOVcmiAJs2w+PzzUEMJXl6o+m2gL5/mmwObKEHITA9w4eMmZeACkyBgCCqqfJ04jRv1ZvbsjTXKnv/U2nV9HSIcmkkfIFn8BsQOisjpcBiJoy7uhddYEWTGjRa/FntYqMfa1zZYLVs5piaAOWhIs1JXh2lHJDDFhQHdc35+Nk2EbFf4JAOYFWypXo06D0LfUdVIsRC4YrOUA06Jpg2YjwduW3/g6tyBNpO61/106mcvgEU0lMJrxoFbH91GQhSsJhrVR5a1aUgb91q3fA2Q4j78HI3Lyx2iw52yV9AAKdMnbJZIntbfy24Xqn8CbQ8a8mzNzgTzo1Nr/N0cJ5W163cXAKKU6L4k7um0FhoY1bwOgwjE4+m9erFJe8e3l0wn8KCtH4HifReTxlBRcrahS5z2I10sbFXWcW3c7FMsruzR5iIXNfMH5NokL6E8Tc+f7Gk85chCidNncEfKMKAC5XRJtN7wThWy4lGZJwkKsXtUTjL61IyXus2HzNaNM3WR7WAFYcaIaHAaqtDtknWpyhOhZ7w4vhxUBjQyAj5U5e+7yQ60Unj+4Ipu3oQhfw+ge0=